!function(e){var i=10,s=.95;function t(t){var r=null,a=null,l=null,n=null,o=null,p=null,h=!1,u=null,c=[];function g(i,s,t){h||(h=!0,r=i.getCanvas(),a=e(r).parent(),l=i.getOptions(),i.setData(d(i.getData())))}function d(i){var s,t,r=0,a=0,n=0,o=l.series.pie.combine.color,p=[];for(s=0;s<i.length;++s)t=i[s].data,e.isArray(t)&&1===t.length&&(t=t[0]),e.isArray(t)?!isNaN(parseFloat(t[1]))&&isFinite(t[1])?t[1]=+t[1]:t[1]=0:t=!isNaN(parseFloat(t))&&isFinite(t)?[1,+t]:[1,0],i[s].data=[t];for(s=0;s<i.length;++s)r+=i[s].data[0][1];for(s=0;s<i.length;++s)(t=i[s].data[0][1])/r<=l.series.pie.combine.threshold&&(a+=t,n++,o||(o=i[s].color));for(s=0;s<i.length;++s)t=i[s].data[0][1],(n<2||t/r>l.series.pie.combine.threshold)&&p.push(e.extend(i[s],{data:[[1,t]],color:i[s].color,label:i[s].label,angle:t*Math.PI*2/r,percent:t/(r/100)}));return n>1&&p.push({data:[[1,a]],color:o,label:l.series.pie.combine.label,angle:a*Math.PI*2/r,percent:a/(r/100)}),p}function f(t,r){if(a){var c=t.getPlaceholder().width(),g=t.getPlaceholder().height(),d=a.children().filter(".legend").children().width()||0;u=r,h=!1,n=Math.min(c,g/l.series.pie.tilt)/2,p=g/2+l.series.pie.offset.top,o=c/2,"auto"===l.series.pie.offset.left?(l.legend.position.match("w")?o+=d/2:o-=d/2,o<n?o=n:o>c-n&&(o=c-n)):o+=l.series.pie.offset.left;var f=t.getData(),b=0;do{b>0&&(n*=s),b+=1,w(),l.series.pie.tilt<=.8&&k()}while(!M()&&b<i);b>=i&&(w(),a.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")),t.setSeries&&t.insertLegend&&(t.setSeries(f),t.insertLegend())}function w(){u.clearRect(0,0,c,g),a.children().filter(".pieLabel, .pieLabelBackground").remove()}function k(){var e=l.series.pie.shadow.left,i=l.series.pie.shadow.top,s=10,t=l.series.pie.shadow.alpha,r=l.series.pie.radius>1?l.series.pie.radius:n*l.series.pie.radius;if(!(r>=c/2-e||r*l.series.pie.tilt>=g/2-i||r<=s)){u.save(),u.translate(e,i),u.globalAlpha=t,u.fillStyle="#000",u.translate(o,p),u.scale(1,l.series.pie.tilt);for(var a=1;a<=s;a++)u.beginPath(),u.arc(0,0,r,0,2*Math.PI,!1),u.fill(),r-=a;u.restore()}}function M(){var i,s=Math.PI*l.series.pie.startAngle,t=l.series.pie.radius>1?l.series.pie.radius:n*l.series.pie.radius;u.save(),u.translate(o,p),u.scale(1,l.series.pie.tilt),u.save();var r=s;for(i=0;i<f.length;++i)f[i].startAngle=r,h(f[i].angle,f[i].color,!0);if(u.restore(),l.series.pie.stroke.width>0){for(u.save(),u.lineWidth=l.series.pie.stroke.width,r=s,i=0;i<f.length;++i)h(f[i].angle,l.series.pie.stroke.color,!1);u.restore()}return v(u),u.restore(),!l.series.pie.label.show||d();function h(e,i,s){e<=0||isNaN(e)||(s?u.fillStyle=i:(u.strokeStyle=i,u.lineJoin="round"),u.beginPath(),Math.abs(e-2*Math.PI)>1e-9&&u.moveTo(0,0),u.arc(0,0,t,r,r+e/2,!1),u.arc(0,0,t,r+e/2,r+e,!1),u.closePath(),r+=e,s?u.fill():u.stroke())}function d(){for(var i=s,t=l.series.pie.label.radius>1?l.series.pie.label.radius:n*l.series.pie.label.radius,r=0;r<f.length;++r){if(f[r].percent>=100*l.series.pie.label.threshold&&!h(f[r],i,r))return!1;i+=f[r].angle}return!0;function h(i,s,r){if(0===i.data[0][1])return!0;var n,h=l.legend.labelFormatter,u=l.series.pie.label.formatter;n=h?h(i.label,i):i.label,u&&(n=u(n,i));var d=(s+i.angle+s)/2,f=o+Math.round(Math.cos(d)*t),v=p+Math.round(Math.sin(d)*t)*l.series.pie.tilt,b="<span class='pieLabel' id='pieLabel"+r+"' style='position:absolute;top:"+v+"px;left:"+f+"px;'>"+n+"</span>";a.append(b);var w=a.children("#pieLabel"+r),k=v-w.height()/2,M=f-w.width()/2;if(w.css("top",k),w.css("left",M),0-k>0||0-M>0||g-(k+w.height())<0||c-(M+w.width())<0)return!1;if(0!==l.series.pie.label.background.opacity){var m=l.series.pie.label.background.color;null==m&&(m=i.color);var P="top:"+k+"px;left:"+M+"px;";e("<div class='pieLabelBackground' style='position:absolute;width:"+w.width()+"px;height:"+w.height()+"px;"+P+"background-color:"+m+";'></div>").css("opacity",l.series.pie.label.background.opacity).insertBefore(w)}return!0}}}}function v(e){if(l.series.pie.innerRadius>0){e.save();var i=l.series.pie.innerRadius>1?l.series.pie.innerRadius:n*l.series.pie.innerRadius;e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=l.series.pie.stroke.color,e.arc(0,0,i,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=l.series.pie.stroke.color,e.arc(0,0,i,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore()}}function b(e,i){for(var s=!1,t=-1,r=e.length,a=r-1;++t<r;a=t)(e[t][1]<=i[1]&&i[1]<e[a][1]||e[a][1]<=i[1]&&i[1]<e[t][1])&&i[0]<(e[a][0]-e[t][0])*(i[1]-e[t][1])/(e[a][1]-e[t][1])+e[t][0]&&(s=!s);return s}function w(e,i){for(var s,r,a=t.getData(),l=t.getOptions(),h=l.series.pie.radius>1?l.series.pie.radius:n*l.series.pie.radius,c=0;c<a.length;++c){var g=a[c];if(g.pie.show){if(u.save(),u.beginPath(),u.moveTo(0,0),u.arc(0,0,h,g.startAngle,g.startAngle+g.angle/2,!1),u.arc(0,0,h,g.startAngle+g.angle/2,g.startAngle+g.angle,!1),u.closePath(),s=e-o,r=i-p,u.isPointInPath){if(u.isPointInPath(e-o,i-p))return u.restore(),{datapoint:[g.percent,g.data],dataIndex:0,series:g,seriesIndex:c}}else if(b([[0,0],[h*Math.cos(g.startAngle),h*Math.sin(g.startAngle)],[h*Math.cos(g.startAngle+g.angle/4),h*Math.sin(g.startAngle+g.angle/4)],[h*Math.cos(g.startAngle+g.angle/2),h*Math.sin(g.startAngle+g.angle/2)],[h*Math.cos(g.startAngle+g.angle/1.5),h*Math.sin(g.startAngle+g.angle/1.5)],[h*Math.cos(g.startAngle+g.angle),h*Math.sin(g.startAngle+g.angle)]],[s,r]))return u.restore(),{datapoint:[g.percent,g.data],dataIndex:0,series:g,seriesIndex:c};u.restore()}}return null}function k(e){m("plothover",e)}function M(e){m("plotclick",e)}function m(e,i){var s=t.offset(),r=w(parseInt(i.pageX-s.left),parseInt(i.pageY-s.top));if(l.grid.autoHighlight)for(var n=0;n<c.length;++n){var o=c[n];o.auto!==e||r&&o.series===r.series||A(o.series)}r&&P(r.series,e);var p={pageX:i.pageX,pageY:i.pageY};a.trigger(e,[p,r])}function P(e,i){var s=y(e);-1===s?(c.push({series:e,auto:i}),t.triggerRedrawOverlay()):i||(c[s].auto=!1)}function A(e){null==e&&(c=[],t.triggerRedrawOverlay());var i=y(e);-1!==i&&(c.splice(i,1),t.triggerRedrawOverlay())}function y(e){for(var i=0;i<c.length;++i)if(c[i].series===e)return i;return-1}function I(e,i){var s=e.getOptions(),t=s.series.pie.radius>1?s.series.pie.radius:n*s.series.pie.radius;i.save(),i.translate(o,p),i.scale(1,s.series.pie.tilt);for(var r=0;r<c.length;++r)a(c[r].series);function a(e){e.angle<=0||isNaN(e.angle)||(i.fillStyle="rgba(255, 255, 255, "+s.series.pie.highlight.opacity+")",i.beginPath(),Math.abs(e.angle-2*Math.PI)>1e-9&&i.moveTo(0,0),i.arc(0,0,t,e.startAngle,e.startAngle+e.angle/2,!1),i.arc(0,0,t,e.startAngle+e.angle/2,e.startAngle+e.angle,!1),i.closePath(),i.fill())}v(i),i.restore()}t.hooks.processOptions.push((function(e,i){i.series.pie.show&&(i.grid.show=!1,"auto"===i.series.pie.label.show&&(i.legend.show?i.series.pie.label.show=!1:i.series.pie.label.show=!0),"auto"===i.series.pie.radius&&(i.series.pie.label.show?i.series.pie.radius=3/4:i.series.pie.radius=1),i.series.pie.tilt>1?i.series.pie.tilt=1:i.series.pie.tilt<0&&(i.series.pie.tilt=0))})),t.hooks.bindEvents.push((function(e,i){var s=e.getOptions();s.series.pie.show&&(s.grid.hoverable&&(i.unbind("mousemove").mousemove(k),i.bind("mouseleave",k)),s.grid.clickable&&i.unbind("click").click(M))})),t.hooks.shutdown.push((function(e,i){i.unbind("mousemove",k),i.unbind("mouseleave",k),i.unbind("click",M),c=[]})),t.hooks.processDatapoints.push((function(e,i,s,t){e.getOptions().series.pie.show&&g(e,i,s,t)})),t.hooks.drawOverlay.push((function(e,i){e.getOptions().series.pie.show&&I(e,i)})),t.hooks.draw.push((function(e,i){e.getOptions().series.pie.show&&f(e,i)}))}var r={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(e,i){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+i.color+";'>"+e+"<br/>"+Math.round(i.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};e.plot.plugins.push({init:t,options:r,name:"pie",version:"1.1"})}(jQuery);