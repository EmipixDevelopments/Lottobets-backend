var e;e=function(e){var t=e.commands,n=e.Pos;function r(e,t){return e.line==t.line&&e.ch==t.ch}var a=[];function o(e){a.push(e),a.length>50&&a.shift()}function i(e){if(!a.length)return o(e);a[a.length-1]+=e}function l(e){return a[a.length-(e?Math.min(e,1):1)]||""}function c(){return a.length>1&&a.pop(),l()}var u=null;function s(e,t,n,a,l){null==l&&(l=e.getRange(t,n)),"grow"==a&&u&&u.cm==e&&r(t,u.pos)&&e.isClean(u.gen)?i(l):!1!==a&&o(l),e.replaceRange("",t,n,"+delete"),u="grow"==a?{cm:e,pos:t,gen:e.changeGeneration()}:null}function d(e,t,n){return e.findPosH(t,n,"char",!0)}function f(e,t,n){return e.findPosH(t,n,"word",!0)}function p(e,t,n){return e.findPosV(t,n,"line",e.doc.sel.goalColumn)}function g(e,t,n){return e.findPosV(t,n,"page",e.doc.sel.goalColumn)}function C(e,t,r){for(var a=t.line,o=e.getLine(a),i=/\S/.test(r<0?o.slice(0,t.ch):o.slice(t.ch)),l=e.firstLine(),c=e.lastLine();;){if((a+=r)<l||a>c)return e.clipPos(n(a-r,r<0?0:null));if(o=e.getLine(a),/\S/.test(o))i=!0;else if(i)return n(a,0)}}function h(e,t,r){for(var a=t.line,o=t.ch,i=e.getLine(t.line),l=!1;;){var c=i.charAt(o+(r<0?-1:0));if(c){if(l&&/[!?.]/.test(c))return n(a,o+(r>0?1:0));l||(l=/\w/.test(c)),o+=r}else{if(a==(r<0?e.firstLine():e.lastLine()))return n(a,o);if(i=e.getLine(a+r),!/\S/.test(i))return n(a,o);a+=r,o=r<0?i.length:0}}}function w(e,t,a){var o;if(e.findMatchingBracket&&(o=e.findMatchingBracket(t,{strict:!0}))&&o.match&&(o.forward?1:-1)==a)return a>0?n(o.to.line,o.to.ch+1):o.to;for(var i=!0;;i=!1){var l=e.getTokenAt(t),c=n(t.line,a<0?l.start:l.end);if(!(i&&a>0&&l.end==t.ch)&&/\w/.test(l.string))return c;var u=e.findPosH(c,a,"char");if(r(c,u))return t;t=u}}function m(e,t){var n=e.state.emacsPrefix;return n?(R(e),"-"==n?-1:Number(n)):t?null:1}function k(e){var t="string"==typeof e?function(t){t.execCommand(e)}:e;return function(e){var n=m(e);t(e);for(var r=1;r<n;++r)t(e)}}function S(e,t,n,a){var o=m(e);o<0&&(a=-a,o=-o);for(var i=0;i<o;++i){var l=n(e,t,a);if(r(l,t))break;t=l}return t}function v(e,t){var n=function(n){n.extendSelection(S(n,n.getCursor(),e,t))};return n.motion=!0,n}function A(e,t,n,r){for(var a,o=e.listSelections(),i=o.length;i--;)s(e,a=o[i].head,S(e,a,t,n),r)}function b(e,t){if(e.somethingSelected()){for(var n,r=e.listSelections(),a=r.length;a--;)s(e,(n=r[a]).anchor,n.head,t);return!0}}function x(e,t){e.state.emacsPrefix?"-"!=t&&(e.state.emacsPrefix+=t):(e.state.emacsPrefix=t,e.on("keyHandled",P),e.on("inputRead",y))}var L={"Alt-G":!0,"Ctrl-X":!0,"Ctrl-Q":!0,"Ctrl-U":!0};function P(e,t){e.state.emacsPrefixMap||L.hasOwnProperty(t)||R(e)}function R(e){e.state.emacsPrefix=null,e.off("keyHandled",P),e.off("inputRead",y)}function y(e,t){var n=m(e);if(n>1&&"+input"==t.origin){for(var r=t.text.join("\n"),a="",o=1;o<n;++o)a+=r;e.replaceSelection(a)}}function W(e,t){("string"!=typeof t||!/^\d$/.test(t)&&"Ctrl-U"!=t)&&(e.removeKeyMap(B),e.state.emacsPrefixMap=!1,e.off("keyHandled",W),e.off("inputRead",W))}function U(e){e.setExtending(!1),e.setCursor(e.getCursor())}function M(e){var t=document.createDocumentFragment(),n=document.createElement("input");return n.setAttribute("type","text"),n.style.width="10em",t.appendChild(document.createTextNode(e+": ")),t.appendChild(n),t}function D(e,t,n){e.openDialog?e.openDialog(M(t),n,{bottom:!0}):n(prompt(t,""))}function E(e,t){var n=e.getCursor(),r=e.findPosH(n,1,"word");e.replaceRange(t(e.getRange(n,r)),n,r),e.setCursor(r)}function K(e){for(var t=e.getCursor(),r=t.line,a=t.ch,o=[];r>=e.firstLine();){for(var i=e.getLine(r),l=null==a?i.length:a;l>0;)if(")"==(a=i.charAt(--l)))o.push("(");else if("]"==a)o.push("[");else if("}"==a)o.push("{");else if(/[\(\{\[]/.test(a)&&(!o.length||o.pop()!=a))return e.extendSelection(n(r,l));--r,a=null}}t.setMark=function(e){e.setCursor(e.getCursor()),e.setExtending(!e.getExtending()),e.on("change",(function(){e.setExtending(!1)}))},t.killRegion=function(e){s(e,e.getCursor("start"),e.getCursor("end"),!0)},t.killLineEmacs=k((function(e){var t=e.getCursor(),r=e.clipPos(n(t.line)),a=e.getRange(t,r);/\S/.test(a)||(a+="\n",r=n(t.line+1,0)),s(e,t,r,"grow",a)})),t.killRingSave=function(e){o(e.getSelection()),U(e)},t.yank=function(e){var t=e.getCursor();e.replaceRange(l(m(e)),t,t,"paste"),e.setSelection(t,e.getCursor())},t.yankPop=function(e){e.replaceSelection(c(),"around","paste")},t.forwardChar=v(d,1),t.backwardChar=v(d,-1),t.deleteChar=function(e){A(e,d,1,!1)},t.deleteForwardChar=function(e){b(e,!1)||A(e,d,1,!1)},t.deleteBackwardChar=function(e){b(e,!1)||A(e,d,-1,!1)},t.forwardWord=v(f,1),t.backwardWord=v(f,-1),t.killWord=function(e){A(e,f,1,"grow")},t.backwardKillWord=function(e){A(e,f,-1,"grow")},t.nextLine=v(p,1),t.previousLine=v(p,-1),t.scrollDownCommand=v(g,-1),t.scrollUpCommand=v(g,1),t.backwardParagraph=v(C,-1),t.forwardParagraph=v(C,1),t.backwardSentence=v(h,-1),t.forwardSentence=v(h,1),t.killSentence=function(e){A(e,h,1,"grow")},t.backwardKillSentence=function(e){s(e,e.getCursor(),h(e,e.getCursor(),1),"grow")},t.killSexp=function(e){A(e,w,1,"grow")},t.backwardKillSexp=function(e){A(e,w,-1,"grow")},t.forwardSexp=v(w,1),t.backwardSexp=v(w,-1),t.markSexp=function(e){var t=e.getCursor();e.setSelection(S(e,t,w,1),t)},t.transposeSexps=function(e){var t=w(e,e.getCursor(),-1),n=w(e,t,1),r=w(e,n,1),a=w(e,r,-1);e.replaceRange(e.getRange(a,r)+e.getRange(n,a)+e.getRange(t,n),t,r)},t.backwardUpList=k(K),t.justOneSpace=function(e){for(var t=e.getCursor(),r=t.ch,a=t.ch,o=e.getLine(t.line);r&&/\s/.test(o.charAt(r-1));)--r;for(;a<o.length&&/\s/.test(o.charAt(a));)++a;e.replaceRange(" ",n(t.line,r),n(t.line,a))},t.openLine=k((function(e){e.replaceSelection("\n","start")})),t.transposeCharsRepeatable=k((function(e){e.execCommand("transposeChars")})),t.capitalizeWord=k((function(e){E(e,(function(e){var t=e.search(/\w/);return-1==t?e:e.slice(0,t)+e.charAt(t).toUpperCase()+e.slice(t+1).toLowerCase()}))})),t.upcaseWord=k((function(e){E(e,(function(e){return e.toUpperCase()}))})),t.downcaseWord=k((function(e){E(e,(function(e){return e.toLowerCase()}))})),t.undoRepeatable=k("undo"),t.keyboardQuit=function(e){e.execCommand("clearSearch"),U(e)},t.newline=k((function(e){e.replaceSelection("\n","end")})),t.gotoLine=function(e){var t=m(e,!0);if(null!=t&&t>0)return e.setCursor(t-1);D(e,"Goto line",(function(t){var n;t&&!isNaN(n=Number(t))&&n==(0|n)&&n>0&&e.setCursor(n-1)}))},t.indentRigidly=function(e){e.indentSelection(m(e,!0)||e.getOption("indentUnit"))},t.exchangePointAndMark=function(e){e.setSelection(e.getCursor("head"),e.getCursor("anchor"))},t.quotedInsertTab=k("insertTab"),t.universalArgument=function(e){e.state.emacsPrefixMap=!0,e.addKeyMap(B),e.on("keyHandled",W),e.on("inputRead",W)},e.emacs={kill:s,killRegion:b,repeated:k};var X=e.keyMap.emacs=e.normalizeKeyMap({"Ctrl-W":"killRegion","Ctrl-K":"killLineEmacs","Alt-W":"killRingSave","Ctrl-Y":"yank","Alt-Y":"yankPop","Ctrl-Space":"setMark","Ctrl-Shift-2":"setMark","Ctrl-F":"forwardChar","Ctrl-B":"backwardChar",Right:"forwardChar",Left:"backwardChar","Ctrl-D":"deleteChar",Delete:"deleteForwardChar","Ctrl-H":"deleteBackwardChar",Backspace:"deleteBackwardChar","Alt-F":"forwardWord","Alt-B":"backwardWord","Alt-Right":"forwardWord","Alt-Left":"backwardWord","Alt-D":"killWord","Alt-Backspace":"backwardKillWord","Ctrl-N":"nextLine","Ctrl-P":"previousLine",Down:"nextLine",Up:"previousLine","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":"scrollDownCommand","Ctrl-V":"scrollUpCommand",PageUp:"scrollDownCommand",PageDown:"scrollUpCommand","Ctrl-Up":"backwardParagraph","Ctrl-Down":"forwardParagraph","Alt-{":"backwardParagraph","Alt-}":"forwardParagraph","Alt-A":"backwardSentence","Alt-E":"forwardSentence","Alt-K":"killSentence","Ctrl-X Delete":"backwardKillSentence","Ctrl-Alt-K":"killSexp","Ctrl-Alt-Backspace":"backwardKillSexp","Ctrl-Alt-F":"forwardSexp","Ctrl-Alt-B":"backwardSexp","Shift-Ctrl-Alt-2":"markSexp","Ctrl-Alt-T":"transposeSexps","Ctrl-Alt-U":"backwardUpList","Alt-Space":"justOneSpace","Ctrl-O":"openLine","Ctrl-T":"transposeCharsRepeatable","Alt-C":"capitalizeWord","Alt-U":"upcaseWord","Alt-L":"downcaseWord","Alt-;":"toggleComment","Ctrl-/":"undoRepeatable","Shift-Ctrl--":"undoRepeatable","Ctrl-Z":"undoRepeatable","Cmd-Z":"undoRepeatable","Ctrl-X U":"undoRepeatable","Shift-Ctrl-Z":"redo","Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findPersistentNext","Ctrl-R":"findPersistentPrev","Ctrl-G":"keyboardQuit","Shift-Alt-5":"replace","Alt-/":"autocomplete",Enter:"newlineAndIndent","Ctrl-J":"newline",Tab:"indentAuto","Alt-G G":"gotoLine","Ctrl-X Tab":"indentRigidly","Ctrl-X Ctrl-X":"exchangePointAndMark","Ctrl-X Ctrl-S":"save","Ctrl-X Ctrl-W":"save","Ctrl-X S":"saveAll","Ctrl-X F":"open","Ctrl-X K":"close","Ctrl-X H":"selectAll","Ctrl-Q Tab":"quotedInsertTab","Ctrl-U":"universalArgument",fallthrough:"default"}),B={"Ctrl-G":R};function H(e){B[e]=function(t){x(t,e)},X["Ctrl-"+e]=function(t){x(t,e)},L["Ctrl-"+e]=!0}for(var T=0;T<10;++T)H(String(T));H("-")},"object"==typeof exports&&"object"==typeof module?e(require("../lib/codemirror")):"function"==typeof define&&define.amd?define(["../lib/codemirror"],e):e(CodeMirror);